import { z } from "zod";
import { v4 as uuidv4 } from "uuid";
/** Item with single autogenerated uuid */
export interface ItemId {
    readonly id?: string;
}
export const itemIdEncodeZod = z.object({ id: z.string().default(uuidv4()) }).transform(({ id }) => id);
export const encodeItemId: (id: ItemId) => string = itemIdEncodeZod.parse;
export const decodeItemId: (id: string) => Required<ItemId> = (id) => {
    return { id };
};

export interface ItemData {
    readonly name: string;
    readonly value: string;
    //TODO: Add support for bigint by adding optional decodeData validator
    // readonly valueBig?: bigint;
    readonly count: number;
    readonly owner: string;
    readonly map: {
        [k: string]: string;
    };
    readonly objectArray: Array<Record<string, any>>;
}
export const itemDataZod = z
    .object({
        name: z.string().describe("string"),
        value: z.string().describe("value"),
        // valueBig: z.bigint().optional().describe("valueBig"),
        count: z.number().describe("number"),
        owner: z.string().describe("owner"),
        map: z.record(z.string(), z.string()).describe("map"),
        objectArray: z.array(z.record(z.string(), z.string())).describe("objectArray"),
    })
    .describe("team");
export const encodeItemData: (data: ItemData) => ItemData = itemDataZod.parse;
export const encodeItemDataPartial: (data: Partial<ItemData>) => Partial<ItemData> = itemDataZod.partial().parse;
export const decodeItemData = encodeItemData;

export type Item = Required<ItemId> & ItemData;

/** ItemComposite with composite id */
export interface ItemCompositeId {
    readonly idPrefix: string;
    readonly idSuffix: string;
}
export const itemCompositeIdEncodeZod = z
    .object({ idPrefix: z.string(), idSuffix: z.string() })
    .transform(({ idPrefix, idSuffix }) => `${idPrefix}-${idSuffix}`);
export const encodeItemCompositeId: (id: ItemCompositeId) => string = itemCompositeIdEncodeZod.parse;
export const decodeItemCompositeId: (id: string) => ItemCompositeId = (id) => {
    const [idPrefix, idSuffix] = id.split("-");
    return { idPrefix, idSuffix };
};

export type ItemComposite = Required<ItemCompositeId> & ItemData;
